recommends: false

include:
  - manifest-tier-0.yaml
  - dnf.yaml
  - firmware.yaml
  - persistent-journal.yaml

packages:
  - audit-libs
  - bluechi-agent
  - bluechi-controller
  - bluechi-ctl
  - bzip2-libs
  - ca-certificates
  - centos-gpg-keys
  - centos-release-autosd
  - centos-stream-repos
  - conmon
  - containers-common
  - container-selinux
  - coreutils-common
  - cracklib-dicts
  - crypto-policies
  - cryptsetup-libs
  - cyrus-sasl-lib
  - dbus-broker
  - dbus-common
  - device-mapper
  - device-mapper-libs
  - dracut-config-generic
  - e2fsprogs-libs
  - efi-filesystem
  - efivar-libs
  - file-libs
  - fuse3
  - fuse3-libs
  - fuse-common
  - fuse-libs
  - fuse-overlayfs
  - gdbm-libs
  - gettext-libs
  - glibc-common
  - glibc-langpack-en
  - grub2-common
  - grub2-efi-x64
  - grub2-tools
  - grub2-tools-minimal
  - iptables-libs
  - iptables-nft
  - json-c
  - json-glib
  - kbd-legacy
  - kbd-misc
  - kernel-automotive
  - kernel-automotive-core
  - kernel-automotive-modules
  - kernel-automotive-modules-core
  - keyutils-libs
  - kmod-libs
  - krb5-libs
  - libcap-ng
  # - libdnf
  - libgpg-error
  - libkcapi-hmaccalc
  - libselinux-utils
  - libslirp
  - libssh-config
  - linux-firmware
  - linux-firmware-whence
  - lua-libs
  - lz4-libs
  - ncurses-base
  - ncurses-libs
  - netavark
  - NetworkManager-libnm
  - nftables
  - nss-altfiles
  - openssl-libs
  - os-prober
  - ostree-libs
  - p11-kit
  - p11-kit-trust
  - pcre2-syntax
  - podman
  - polkit
  - polkit-libs
  - procps-ng
  - python3-dnf
  - python3-libcomps
  - python3-libdnf
  - publicsuffix-list-dafsa
  - qm
  - rpm-libs
  - rpm-ostree
  - rpm-ostree-libs
  - rpm-plugin-selinux
  - selinux-policy
  - selinux-policy-targeted
  - shadow-utils
  - shadow-utils-subid
  - shared-mime-info
  - shim-x64
  - slirp4netns
  - sqlite-libs
  - systemd-libs
  - systemd-pam
  - systemd-rpm-macros
  - systemd-udev
  - tpm2-tss
  - util-linux
  - util-linux-core
  - xz-libs
# These are random architecture-specific packages
packages-x86_64:
  - irqbalance
packages-aarch64:
  - irqbalance

postprocess:
  # Undo RPM scripts enabling units; we want the presets to be canonical
  # https://github.com/projectatomic/rpm-ostree/issues/1803
  - |
    #!/usr/bin/env bash
    set -xeuo pipefail
    rm -rf /etc/systemd/system/*
    systemctl preset-all
    rm -rf /etc/systemd/user/*
    systemctl --user --global preset-all
  # Default to iptables-nft. Otherwise, legacy wins. We can drop this once/if we
  # remove iptables-legacy. This is needed because alternatives don't work
  # https://github.com/coreos/fedora-coreos-tracker/issues/677
  # https://github.com/coreos/fedora-coreos-tracker/issues/676
  - |
    #!/usr/bin/env bash
    set -xeuo pipefail
    ln -sf /usr/sbin/ip6tables-nft         /etc/alternatives/ip6tables
    ln -sf /usr/sbin/ip6tables-nft-restore /etc/alternatives/ip6tables-restore
    ln -sf /usr/sbin/ip6tables-nft-save    /etc/alternatives/ip6tables-save
    ln -sf /usr/sbin/iptables-nft          /etc/alternatives/iptables
    ln -sf /usr/sbin/iptables-nft-restore  /etc/alternatives/iptables-restore
    ln -sf /usr/sbin/iptables-nft-save     /etc/alternatives/iptables-save
  # See: https://github.com/coreos/fedora-coreos-tracker/issues/1253
  #      https://bugzilla.redhat.com/show_bug.cgi?id=2112857
  #      https://github.com/coreos/rpm-ostree/issues/3918
  # Temporary workaround to remove the SetGID binary from liblockfile that is
  # pulled by the s390utils but not needed for /usr/sbin/zipl.
  - |
    #!/usr/bin/env bash
    set -xeuo pipefail
    rm -f /usr/bin/dotlockfile

# Things we don't expect to ship on the host.  We currently
# have recommends: false so these could only come in via
# hard requirement, in which case the build will fail.
exclude-packages:
  - attr
  - audit
  - avahi
  # - bootc
  # - bootupd
  - bzip2
  - c
  - ca
  - centos
  - container
  - containers
  - crypto
  - cryptsetup
  - cyrus
  - device
  # - dnf
  # - dosfstools
  - efi
  - efivar
  - elfutils
  - gdbm
  # - gdisk
  - grub2
  - gssproxy
  - ima
  # - inih
  - iptables
  # - irqbalance
  - json
  - kernel
  - keyutils
  - krb5
  - libbasicobjects
  - libcollection
  # - libcomps
  - libdhash
  # - libdnf
  # - libedit
  - libev
  - libgpg
  - libicu
  - libini_config
  - libipa_hbac
  - libldb
  - libnfsidmap
  - libnl3
  - libpath_utils
  - libref_array
  - libreport
  - libsmbclient
  - libsss_certmap
  - libsss_idmap
  - libsss_nss_idmap
  - libsss_sudo
  - libtalloc
  - libtdb
  - libtevent
  - libtirpc
  - libwbclient
  - linux
  - lmdb
  - lsof
  - lua
  - ncurses
  - nfs
  - nss
  - numactl
  - os
  - p11
  # - polkit
  - procps
  - publicsuffix
  # - python3
  - quota
  - rpcbind
  - samba
  - selinux
  - shadow
  - shared
  - shim
  - sqlite
  - sssd
  - tpm2
  - userspace
  - util
  - WALinuxAgent
  # - xfsprogs
  - zram- 
